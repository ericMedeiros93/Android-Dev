package com.NaN.nutracker;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Context;
import android.os.AsyncTask;

import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

public class GetJson extends AsyncTask<String, Void, Boolean> {
	String u, p;
	String result = "fail";
	private ProgressDialog dialog;
	private Activity activity;
	private Context context;

	public GetJson(Activity activity) {
		this.activity = activity;
		context = activity;
		dialog = new ProgressDialog(context);
	}

	@Override
	protected Boolean doInBackground(String... params) {
		// TODO Auto-generated method stub
		this.u = params[0];
		this.p = params[1];

		return GetSomething();
	}

	final boolean GetSomething() {
		boolean correct = false;
		String url = "http://142.55.49.127/WebAPI/api/Login?username="+md5(u)+"&password="+md5(p);
		BufferedReader inStream = null;
		try {
			HttpClient httpClient = new DefaultHttpClient();
			HttpGet httpRequest = new HttpGet(url);
			HttpResponse response = httpClient.execute(httpRequest);
			if(response.getStatusLine().getStatusCode() == 200){
				correct = true;
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
		
		dialog.dismiss();
		return (correct);
		
	}
	}

	protected void onPostExecute(String result) {
		// t.setText(result);

	}

	@Override
	protected void onPreExecute() {
		// TODO Auto-generated method stub
		this.dialog.setMessage("Logging In!");
		this.dialog.show();

	}

	
	
private static String md5(String s) { try { 
        
        // Create MD5 Hash 
        MessageDigest digest = java.security.MessageDigest.getInstance("MD5"); 
        digest.update(s.getBytes()); 
        byte messageDigest[] = digest.digest();
 
         // Create Hex String
         StringBuffer hexString = new StringBuffer();
         for (int i=0; i<messageDigest.length; i++)
             hexString.append(Integer.toHexString(0xFF & messageDigest[i]));
        return hexString.toString();
 
     } catch (NoSuchAlgorithmException e) {
         e.printStackTrace();
     }
     return "";
 
    }
    
    
}

