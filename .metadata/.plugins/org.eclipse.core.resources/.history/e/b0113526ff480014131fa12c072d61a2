package com.NaN.nutracker;

import java.io.BufferedReader;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.ArrayList;
import java.util.List;

import org.apache.http.HttpResponse;
import org.apache.http.HttpStatus;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Context;
import android.os.AsyncTask;

public class GetJson extends AsyncTask<String, Void, Boolean> {
	String u, p;
	String result = "fail";
	private ProgressDialog dialog;
	private Activity activity;
	private Context context;

	public GetJson(Activity activity) {
		this.activity = activity;
		context = activity;
		dialog = new ProgressDialog(context);
	}

	@Override
	protected Boolean doInBackground(String... params) {
		// TODO Auto-generated method stub
		this.u = params[0];
		this.p = params[1];

		return GetSomething();
	}

	final boolean GetSomething() {
		boolean correct = false;
		String url = "http://142.55.49.127/WebAPI/api/Login?username="+md5(u)+"&password="+md5(p);
		BufferedReader inStream = null;
		try {
			HttpClient httpClient = new DefaultHttpClient();
			HttpPost httpRequest = new HttpPost(url);
			httpRequest.setHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
			HttpResponse response = httpClient.execute(httpRequest);
			if(response.getStatusLine().getStatusCode() == HttpStatus.SC_OK){
				correct = true;
		}} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
		
		this.dialog.dismiss();
		return (correct);
		
	
	}

	protected void onPostExecute(String result) {
		// t.setText(result);

	}

	@Override
	protected void onPreExecute() {
		// TODO Auto-generated method stub
		this.dialog.setMessage("Logging In!");
		this.dialog.show();

	}

	
	
public static String md5(String s) { try { 
        
        // Create MD5 Hash 
        MessageDigest digest = java.security.MessageDigest.getInstance("MD5"); 
        digest.update(s.getBytes()); 
        byte messageDigest[] = digest.digest();
 
         // Create Hex String
         StringBuffer hexString = new StringBuffer();
         for (int i=0; i<messageDigest.length; i++)
             hexString.append(Integer.toHexString(0xFF & messageDigest[i]));
        return hexString.toString();
 
     } catch (NoSuchAlgorithmException e) {
         e.printStackTrace();
     }
     return "";
 
    }
    
    
}

