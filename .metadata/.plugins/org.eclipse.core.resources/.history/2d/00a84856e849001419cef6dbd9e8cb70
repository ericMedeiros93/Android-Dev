package com.NaN.nutracker;

import java.io.IOException;

import org.apache.http.HttpResponse;
import org.apache.http.HttpStatus;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.ByteArrayEntity;
import org.apache.http.impl.client.DefaultHttpClient;

import android.app.Activity;
import android.content.Context;
import android.os.AsyncTask;
import android.util.Log;
import android.widget.Toast;

import com.google.gson.JsonObject;

public class PostClaim extends AsyncTask<String, Void, Boolean> {
	private Activity activity;
	private Context context;
	private String date, description, driverId;
	private boolean ok = false;

	public PostClaim(Activity activity) {
		this.activity = activity;
		this.context= activity;
	}

	@Override
	protected Boolean doInBackground(String... params) {
		driverId = params[0];
		description = params[1];
		date = params[2];
		sendSomething();
		return ok;
		// TODO Auto-generated method stub

	}

	final void sendSomething() {
		String url = "http://142.55.49.127/WebAPI/api/Claims";
		HttpClient httpClient = new DefaultHttpClient();
		HttpPost httpRequest = new HttpPost(url);
		httpRequest
				.setHeader("Content-Type", "application/json; charset=utf-8");
		//httpRequest.setEntity(entity)
		JsonObject jsonObject = new JsonObject();
		jsonObject.addProperty("Date", date);
		jsonObject.addProperty("Description", description);
		jsonObject.addProperty("Driver_Id",driverId);

		try {

			httpRequest.setEntity(new ByteArrayEntity(jsonObject.toString().getBytes("UTF8")));
			//Log.wtf("JSON", jsonObject.toString());
			HttpResponse response = httpClient.execute(httpRequest);
			if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
				ok = true;
			}
		} catch (ClientProtocolException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	protected void onPostExecute(String result) {

		Toast.makeText(context.getApplicationContext() , "Claim submitted successfully!", Toast.LENGTH_SHORT).show();
	}

	@Override
	protected void onPreExecute() {
		// TODO Auto-generated method stub

	}

}
